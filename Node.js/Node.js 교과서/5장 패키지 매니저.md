- [5.1 npm 알아보기](#51-npm-알아보기)
- [5.2 package.json으로 패키지 관리하기](#52-packagejson으로-패키지-관리하기)
- [5.3 패키지 버전 이해하기](#53-패키지-버전-이해하기)
- [5.4 기타 npm 명령어](#54-기타-npm-명령어)
- [5.5 패키지 배포하기](#55-패키지-배포하기)

# 5.1 npm 알아보기

npm은 Node Package Manager의 약어로 노드 패키지 매니저이다.

# 5.2 package.json으로 패키지 관리하기

패키지는 저마다 고유한 버전이 있으며, 같은 패키지라도 버전별로 기능이 다를 수 있으므로 프로젝트를 설치할 때 패키지도 동일한 버전으로 설치하는 것이 좋다. 이때 설치한 패키지의 버전을 관리하는 파일이 package.json이다.

**따라서 노드 프로젝트를 시작하기 전에는 폴더 내부에 무조건 package.json부터 만들고 시작해야 한다.** npm은 package.json을 만드는 명령어를 제공한다.

* package name: 패키지의 이름. package.json의 name 속성에 저장된다.
* version: 패키지의 버전이다. npm의 버전은 다소 엄격하게 관리된다.
* entry point: 자바스크립트 실행 파일 진입점. 보통 마지막으로 module.exports를 하는 파일을 지정한다. package.json의 main 속성에 저장된다.
* test command: 코드를 테스트할 때 입력할 명령어를 의미한다. package.json scripts 속성 안의 test 속성에 저장된다.
* git repository: 코드를 저장해둔 깃(Git) 저장소 주소를 의미한다. package.json의 repository 속성에 저장된다.
* keywords: 키워드는 npm 공식 홈페이지에서 패키지를 쉽게 찾을 수 있도록 해준다. package.json의 keywords 속성에 저장된다.
* license: 해당 패키지의 라이선스를 넣으면 된다.

script 부분은 npm 명령어를 모아놓은 부분으로 콘솔에서 `npm run [스크립트 명령어]`를 입력하면 해당 스크립트가 실행된다. 보통 start 명령어에 `node [파일명]`을 저장해두고 `npm start`로 실행한다. start나 test 같은 스크립트는 run을 붙이지 않아도 실행된다.

패키지 설치는 `npm install [패키지 이름]`을 통해 package.json이 있는 폴더의 콘솔에서 입력하면 된다.

```
$ npm install express
```

설치한 패키지가 package.json에 기록된다.

```json
{
  "name": "npmtest",
  ...
  "license": "ISC",
  "dependencies": {
    "express": "^4.17.3"
  }
}
```

버전 앞에 ^ 표시가 붙는데 여기에는 특별한 의미가 있다.(향후 알아볼 예정)

node_modules라는 폴더가 생성된다. 그 안에 설치한 패키지들이 들어 있다. Express 외에도 다양한 패키지가 들어 있는데, 이는 Express가 의존하는 패키지들이다. 의존 관계가 복잡하게 얽혀 있기 때문에 package.json이 필요한 것이다.

package-lock.json이라는 파일도 생성되어 있는데, express 외에도 node_modules에 들어 있는 패키지들의 정확한 버전과 의존 관계가 담겨있다. mp으로 패키지를 설치, 수정, 삭제할 때마다 패키지들 간의 내부 의존 관계를 이 파일에 저장한다.

모듈을 여러 개 설치할 때는 `npm install [패키지1] [패키지2] [...]`와 같이 나열하면 된다.

```
$ npm install morgan cookie-parser express-session
```

개발용 패키지를 설치할 수도 있다. 실제 배포 시에는 사용되지 않고 개발 중에만 사용되는 패키지들이다. `npm install --save-dev [패키지] [...]`로 설치한다. --save-dev가 개발용 패키지임을 나타낸다.

새로 생긴 devDependencies 속성에서는 개발용 패키지들만 따로 관리한다.

npm에는 전역(global) 설치라는 옵션도 있다. 현재 폴더에 설치하는 것이 아니라 **npm이 설치되어 있는 폴더에 설치**하는 것이다. 이 폴더의 경로는 보통 시스템 환경 변수에 등록되어 있으므로 전역 설치한 패키지는 콘솔의 명령어로 사용할 수 있다. 대부분 명령어로 사용하기 위해 전역 설치한다.

rimraf는 리눅스나 맥의 rm -rf 명령어를 윈도에서도 사용할 수 있게 해주는 패키지이다. rm -rf는 지정한 파일이나 폴더를 지우는 명령어이다. 전역 설치했기 때문에 명령어를 콘솔에서 사용할 수 있다. package.json에는 기록되지 않는다.

rimraf로 node_modules 폴더를 삭제하더라도 package.json에 설치한 패키지 내역이 들어 있으므로 `npm install`만 하면 알아서 다시 설치된다. 즉, **언제든지 설치할 수 있으므로 보관할 필요가 없다.** 깃 같은 버전 관리 프로그램과 같이 사용할 때도 node_modules는 커밋하지 않는다. **중요한 파일은 package.json이다.**

> **npx**
> 
> 전역 설치한 패키지는 package.json에 기록되지 않아 다시 설치할 때 어려움이 따른다. 이러한 경우를 위한 명령어로 npx가 있다.
> ```
> $ npm install --save-dev rimraf
> $ npx rimraf node_modules
> ```
> 위와 같이 rimraf 모듈을 package.json의 devDependencies 속성에 기록한 후, 앞에 npx 명령어를 붙여 실행하면 된다. 이렇게 하면 패키지를 전역 설치한 것과 같은 효과(명령어로 사용 가능)를 얻을 수 있다. 패키지가 package.json에 기록되었으므로 버전 관리도 용이하다.

> **npm에 등록되지 않은 패키지**
> 
> 일부 소스는 오픈 소스가 아니거나 개발 중이므로 깃허브 등의 저장소에 보관되어 잇을 수도 있다. 그러한 패키지들도 `npm install [저장소 주소]` 명령어를 통해 설치할 수 있다.

> **명령어 줄여쓰기**
> 
> npm install 명령어는 npm i로 줄여 쓸 수 있다. --save-dev 옵션은 -D로, --global 옵션은 -g로 줄여 써도 된다.

# 5.3 패키지 버전 이해하기

노드의 버전은 항상 세 자리로 이루어져 있다. SemVar(Semantic Versioning, 유의적 버전) 방식의 버전 넘버링을 따르기 때문이다.

* 첫 번째 자리: major 버전. major 버전이 0이면 초기 개발 중이라는 뜻이다. 1부터 정식 버전을 의미한다. major 버전은 하위 호환이 안 될 정도로 패키지의 내용이 수정되었을 때 올린다.

* 두 번째 자리: minor 버전. 하위 호환이 되는 기능 업데이트를 할 때 올린다. 1.5.0에서 1.6.0으로 업데이트했을 때 아무 문제가 없어야 한다.

* 세 번째 자리: patch 버전. 기존 기능에 문제가 있어 수정한 것을 내놓았을 때 올린다.

새 버전을 배포한 후에는 그 버전의 내용을 절대 수정하면 안 된다. 수정 사항이 생기면 세 자리의 버전 중 하나를 맞게 올려서 새로운 버전으로 배포해야 한다.

package.json에는 SemVar식 세 자리 버전 외에도 버전 앞에 ^이나 ~ 또는 >, < 같은 문자가 붙어 있는데, 이 문자는 버전에는 포함되지 않지만 설치하거나 업데이트할 때 어떤 버전을 설치해야 하는지 알려준다.

* ^ 기호: minor 버전까지만 설치하거나 업데이트 한다. `npm i express@^1.1.1`이라면 1.1.1 이상부터 2.0.0 미만 버전까지 설치된다. 1.x.x와 같이 표현할 수도 있다.

* ~ 기호: patch 버전까지만 설치하거나 업데이트 한다. `npm i express@~1.1.1`이라면 1.1.1 이상부터 1.2.0 미만 버전까지 설치된다. 1.1.x와 같은 표현도 가능하다.

* \>, <, > =, < =, =기호: 초과, 미만 이상, 이하, 동일을 뜻한다. `npm i express@>1.1.1`이라면 반드시 1.1.1 버전보다 높은 버전이 설치된다.

* @latest: 가장  최신 버전의 패키지를 설치. x로도 표현할 수 있다. `npm i express@latest` or `npm i express@x`

* @next: 가장 최근의 배포판을 설치할 수 있다. 안정되지 않은 알파나 베타 버전의 패키지를 설치할 수 있다는 것이다.

# 5.4 기타 npm 명령어

* npm outdated: 업데이트할 수 있는 패키지가 있는지 확인한다. Current와 Wanted가 다르다면 업데이트가 필요한 경우이다. `npm update [패키지명]`으로 업데이트할 수 있다. 그냥 `npm update`를 하면 업데이트 가능한 모든 패키지가 Wanted에 적힌 버전으로 업데이트된다. Latest는 해당 패키지의 최신 버전이지만 **package.json에 적힌 버전 범위와 다르다면 설치되지 않는다.**

* `npm uninstall [패키지명]`: 해당 패키지를 제거하는 명령어. 패키지가 node_modules폴더와 package.json에서 사라진다. `npm rm [패키지명]`으로 줄여쓸 수 있다.

* `npm search [검색어]`: npm의 패키지를 검색할 수 있다.

* `npm info [패키지명]`: 패키지의 세부 정보를 파악하고자 할 때 사용하는 명령어. package.json의 내용과 의존 관계, 설치 가능한 버전 정보 등이 표시된다.

* `npm adduser`: npm 로그인을 위한 명령어. npm 공식 사이트에서 가입한 계정으로 로그인하면 된다. 패키지를 배포할 때 로그인이 필요하다.

* `npm whoami`: 로그인한 사용자가 누구인지 알려준다.

* `npm logout`: npm adduser로 로그인한 계정을 로그아웃할 때 사용한다.

* `npm version [버전]`: package.json의 버전을 올린다. 원하는 버전의 숫자를 넣으면 된다.

* `npm deprecate [패키지명] [버전] [메시지]`: 해당 패키지를 설치할 때 경고 메시지를 띄우게 하는 명령어. 자신의 패키지에만 적용할 수 있다.

* `npm publish`: 자신이 만든 패키지를 배포할 때 사용.

* `npm unpublish`: 배포한 패키지를 제거할 때 사용. 24시간 이내에 배포한 패키지만 제거할 수 있다.

* `npm ci`: package.json 대신 package-lock.json에 기반하여 패키지를 설치. 더 엄격하게 버전을 통제하여 패키지를 설치하고 싶을 때 사용한다.

# 5.5 패키지 배포하기

npm은 패키지의 이름이 겹치는 것을 허용하지 않는다. 따라서 패키지의 이름을 바꿔서 배포해야 한다.

package.json에서 원하는 이름으로 name을 바꾸고, 다시 npm publish 명령어를 입력한다. 패키지에 대한 정보가 나오면 성공이다.

배포한 패키지를 삭제하기 위해서는 `npm unpublish [패키지명] --force`를 입력하여 삭제한다. `npm info [패키지명]`을 통해 제대로 지워졌는지 확인한다.